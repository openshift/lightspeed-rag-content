Managing machines with the Cluster API

Managing machines with the Cluster API is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see Technology Preview Features Support Scope.
Modifying a Cluster API machine template
You can update the machine template resource for your cluster by modifying the YAML manifest file and applying it with the OpenShift CLI (`oc`).

You have deployed an Red Hat OpenShift Container Platform cluster that uses the Cluster API.

You have access to the cluster using an account with cluster-admin permissions.

You have installed the OpenShift CLI (`oc`).


List the machine template resource for your cluster by running the following command:

Write the machine template resource for your cluster to a file that you can edit by running the following command:

Make a copy of the <template_name>.yaml file with a different name. This procedure uses <modified_template_name>.yaml as an example file name.

Use a text editor to make changes to the <modified_template_name>.yaml file that defines the updated machine template resource for your cluster.
When editing the machine template resource, observe the following:

Apply the machine template CR by running the following command:


For any Cluster API compute machine sets that reference this template, update the spec.template.spec.infrastructureRef.name parameter to match the metadata.name value in the new machine template resource.
For more information, see "Modifying a compute machine set by using the CLI."


Sample YAML for a Cluster API machine template resource on Amazon Web Services

Sample YAML for a Cluster API machine template resource on Google Cloud Platform

Modifying a compute machine set by using the CLI
Modifying a compute machine set by using the CLI
When you modify a compute machine set, your changes only apply to compute machines that are created after you save the updated MachineSet custom resource (CR). The changes do not affect existing machines. You can replace the existing machines with new ones that reflect the updated configuration by scaling the compute machine set.

If you need to scale a compute machine set without making other changes, you do not need to delete the machines.

By default, the Red Hat OpenShift Container Platform router pods are deployed on compute machines. Because the router is required to access some cluster resources, including the web console, do not scale the compute machine set to 0 unless you first relocate the router pods.
The output examples in this procedure use the values for an AWS cluster.

Your Red Hat OpenShift Container Platform cluster uses the Cluster API.

You are logged in to the cluster as an administrator by using the OpenShift CLI (`oc`).


List the compute machine sets in your cluster by running the following command:

Edit a compute machine set by running the following command:

Note the value of the spec.replicas field, because you need it when scaling the machine set to apply the changes.

Update the compute machine set CR with the configuration options that you want and save your changes.

List the machines that are managed by the updated compute machine set by running the following command:

For each machine that is managed by the updated compute machine set, set the delete annotation by running the following command:

To create replacement machines with the new configuration, scale the compute machine set to twice the number of replicas by running the following command:

List the machines that are managed by the updated compute machine set by running the following command:

To remove the machines that were created with the old configuration, scale the compute machine set to the original number of replicas by running the following command:


To verify that a machine created by the updated machine set has the correct configuration, examine the relevant fields in the CR for one of the new machines by running the following command:

To verify that the compute machines without the updated configuration are deleted, list the machines that are managed by the updated compute machine set by running the following command:


Sample YAML for a Cluster API compute machine set resource on Amazon Web Services

Sample YAML for a Cluster API compute machine set resource on Google Cloud Platform