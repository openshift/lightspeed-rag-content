Understanding disconnected installation mirroring

You can use a mirror registry for disconnected installations and to ensure that your clusters only use container images that satisfy your organization's controls on external content. Before you install a cluster on infrastructure that you provision in a disconnected environment, you must mirror the required container images into that environment. To mirror container images, you must have a registry for mirroring.
Mirroring images for a disconnected installation through the Agent-based Installer
You can use one of the following procedures to mirror your "Red Hat OpenShift Container Platform" image repository to your mirror registry:

Mirroring images for a disconnected installation

Mirroring images for a disconnected installation using the oc-mirror plugin
About mirroring the "Red Hat OpenShift Container Platform" image repository for a disconnected registry
To use mirror images for a disconnected installation with the Agent-based Installer, you must modify the install-config.yaml file.

You can mirror the release image by using the output of either the oc adm release mirror or oc mirror command. This is dependent on which command you used to set up the mirror registry.

The following example shows the output of the oc adm release mirror command.

$ oc adm release mirror
To use the new mirrored repository to install, add the following
section to the install-config.yaml:

imageContentSources:

mirrors:
virthost.ostest.test.metalkube.org:5000/localimages/local-release-image
source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
mirrors:
virthost.ostest.test.metalkube.org:5000/localimages/local-release-image
source: registry.ci.openshift.org/ocp/release
The following example shows part of the imageContentSourcePolicy.yaml file generated by the oc-mirror plugin. The file can be found in the results directory, for example oc-mirror-workspace/results-1682697932/.

spec:
  repositoryDigestMirrors:
  - mirrors:
    - virthost.ostest.test.metalkube.org:5000/openshift/release
    source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
  - mirrors:
    - virthost.ostest.test.metalkube.org:5000/openshift/release-images
    source: quay.io/openshift-release-dev/ocp-release
Configuring the Agent-based Installer to use mirrored images
You must use the output of either the oc adm release mirror command or the oc-mirror plugin to configure the Agent-based Installer to use mirrored images.

If you used the oc-mirror plugin to mirror your release images:

If you used the oc adm release mirror command to mirror your release images:

Paste the copied text into the imageContentSources field of the install-config.yaml file.

Add the certificate file used for the mirror registry to the additionalTrustBundle field of the yaml file.

If you are using GitOps ZTP manifests: add the registries.conf and ca-bundle.crt files  to the mirror path to add the mirror configuration in the agent ISO image.