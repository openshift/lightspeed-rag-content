Creating virtual machines from instance types

You can simplify virtual machine (VM) creation by using instance types, whether you use the "Red Hat OpenShift Container Platform" web console or the CLI to create VMs.
About instance types
An instance type is a reusable object where you can define resources and characteristics to apply to new VMs. You can define custom instance types or use the variety that are included when you install OpenShift Virtualization.

To create a new instance type, you must first create a manifest, either manually or by using the virtctl CLI tool. You then create the instance type object by applying the manifest to your cluster.

OpenShift Virtualization provides two CRDs for configuring instance types:

A namespaced object: VirtualMachineInstancetype

A cluster-wide object: VirtualMachineClusterInstancetype


These objects use the same VirtualMachineInstancetypeSpec.

Required attributes
When you configure an instance type, you must define the cpu and memory attributes. Other attributes are optional.

When you create a VM from an instance type, you cannot override any parameters defined in the instance type.

Because instance types require defined CPU and memory attributes, OpenShift Virtualization always rejects additional requests for these resources when creating a VM from an instance type.
You can manually create an instance type manifest. For example:

apiVersion: instancetype.kubevirt.io/v1beta1
kind: VirtualMachineInstancetype
metadata:
  name: example-instancetype
spec:
  cpu:
    guest: 1 1
  memory:
    guest: 128Mi 2
Required. Specifies the number of vCPUs to allocate to the guest.

Required. Specifies an amount of memory to allocate to the guest.


You can create an instance type manifest by using the virtctl CLI utility. For example:

$ virtctl create instancetype --cpu 2 --memory 256Mi
where:


--cpu <value>
Specifies the number of vCPUs to allocate to the guest. Required.
--memory <value>
Specifies an amount of memory to allocate to the guest. Required.


You can immediately create the object from the new manifest by running the following command:

$ virtctl create instancetype --cpu 2 --memory 256Mi | oc apply -f -
Optional attributes
In addition to the required cpu and memory attributes, you can include the following optional attributes in the VirtualMachineInstancetypeSpec:


annotations
List annotations to apply to the VM.
gpus
List vGPUs for passthrough.
hostDevices
List host devices for passthrough.
ioThreadsPolicy
Define an IO threads policy for managing dedicated disk access.
launchSecurity
Configure Secure Encrypted Virtualization (SEV).
nodeSelector
Specify node selectors to control the nodes where this VM is scheduled.
schedulerName
Define a custom scheduler to use for this VM instead of the default scheduler.
Pre-defined instance types
OpenShift Virtualization includes a set of pre-defined instance types called common-instancetypes. Some are specialized for specific workloads and others are workload-agnostic.

These instance type resources are named according to their series, version, and size. The size value follows the . delimiter and ranges from nano to 8xlarge.
Creating manifests by using the virtctl tool
You can use the virtctl CLI utility to simplify creating manifests for VMs, VM instance types, and VM preferences. For more information, see VM manifest creation commands.

If you have a VirtualMachine manifest, you can create a VM from the command line.
Creating a VM from an instance type by using the web console
You can create a virtual machine (VM) from an instance type by using the "Red Hat OpenShift Container Platform" web console. You can also use the web console to create a VM by copying an existing snapshot or to clone a VM.

In the web console, navigate to Virtualization -> Catalog and click the InstanceTypes tab.

Select either of the following options:

Click an instance type tile and select the resource size appropriate for your workload.

If you have not already added a public SSH key to your project, click the edit icon beside Authorized SSH key in the VirtualMachine details section.

Select one of the following options:

Optional: Click View YAML & CLI to view the YAML file. Click CLI to view the CLI commands. You can also download or copy either the YAML file contents or the CLI commands.

Click Create VirtualMachine.


After the VM is created, you can monitor the status on the VirtualMachine details page.