# Creating DNS records on Google Cloud Platform


To create DNS records on Google Cloud, use the External DNS Operator. The DNS Operator manages external name resolution for your cluster services.

[IMPORTANT]
----
Using the External DNS Operator on a cluster with Google Cloud Workload Identity enabled is not supported. For more information about the Google Cloud Workload Identity, see Google Cloud Workload Identity.
----

# Creating DNS records on a public managed zone for Google Cloud

To create DNS records on Google Cloud, use the External DNS Operator. The DNS Operator manages external name resolution for your cluster services.

* You must have administrator privileges.

1. Copy the gcp-credentials secret in the encoded-gcloud.json file by running the following command:

```terminal
$ oc get secret gcp-credentials -n kube-system --template='{{$v := index .data "service_account.json"}}{{$v}}' | base64 -d - > decoded-gcloud.json
```

2. Export your Google credentials by running the following command:

```terminal
$ export GOOGLE_CREDENTIALS=decoded-gcloud.json
```

3. Activate your account by using the following command:

```terminal
$ gcloud auth activate-service-account  <client_email as per decoded-gcloud.json> --key-file=decoded-gcloud.json
```

4. Set your project by running the following command:

```terminal
$ gcloud config set project <project_id as per decoded-gcloud.json>
```

5. Get a list of routes by running the following command:

```terminal
$ oc get routes --all-namespaces | grep console
```

Example output

```terminal
openshift-console          console             console-openshift-console.apps.test.gcp.example.com                       console             https   reencrypt/Redirect     None
openshift-console          downloads           downloads-openshift-console.apps.test.gcp.example.com                     downloads           http    edge/Redirect          None
```

6. Get a list of managed zones, such as qe-cvs4g-private-zone test.gcp.example.com, by running the following command:

```terminal
$ gcloud dns managed-zones list | grep test.gcp.example.com
```

7. Create a YAML file, for example, external-dns-sample-gcp.yaml, that defines the ExternalDNS object:
Example external-dns-sample-gcp.yaml file

```yaml
apiVersion: externaldns.olm.openshift.io/v1beta1
kind: ExternalDNS
metadata:
  name: sample-gcp
spec:
  domains:
    - filterType: Include
      matchType: Exact
      name: test.gcp.example.com
  provider:
    type: GCP
  source:
    openshiftRouteOptions:
      routerName: default
    type: OpenShiftRoute
# ...
```


where:
metadata.name:: Specifies the External DNS name.
spec.domains.filterType:: By default, all hosted zones are selected as potential targets. You can include your hosted zone.
spec.domains.matchType:: Specifies the domain of the target that must match the string defined by the name key.
spec.domains.name:: Specifies the exact domain of the zone you want to update. The hostname of the routes must be subdomains of the specified domain.
spec.provider.type:: Specifies the provider type.
source.openshiftRouteOptions:: Specifies options for the source of DNS records.
openshiftRouteOptions.routerName:: If the source type is OpenShiftRoute, you can pass the OpenShift Ingress Controller name. External DNS selects the canonical hostname of that router as the target while creating a CNAME record.
type:: Specifies the route resource as the source for Google Cloud DNS records.
8. Check the DNS records created for Red Hat OpenShift Container Platform routes by running the following command:

```terminal
$ gcloud dns record-sets list --zone=qe-cvs4g-private-zone | grep console
```
