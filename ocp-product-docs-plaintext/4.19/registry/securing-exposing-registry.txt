# Exposing the registry


By default, the OpenShift image registry is secured during cluster installation so that it serves traffic through the Transport Layer Security (TLS) protocol. Unlike previous versions of Red Hat OpenShift Container Platform, the registry is not exposed outside of the cluster at the time of installation.

# Exposing a default registry manually

Instead of logging in to the default OpenShift image registry from within the cluster, you can gain external access to the OpenShift image registry by exposing the registry with a route. With this external access, you can log in to the registry from outside the cluster by using the route address. You can then tag and push images to an existing project by using the route host.

* The following prerequisites are automatically performed:
* Deploy the Registry Operator.
* Deploy the Ingress Operator.
* You have access to the cluster as a user with the cluster-admin role.

1. To expose the registry by using the defaultRoute parameter that exists in the configs.imageregistry.operator.openshift.io resource, set defaultRoute` to true by running the following command:

```terminal
$ oc patch configs.imageregistry.operator.openshift.io/cluster --patch '{"spec":{"defaultRoute":true}}' --type=merge
```

2. Get the default registry route by running the following command:

```terminal
$ HOST=$(oc get route default-route -n openshift-image-registry --template='{{ .spec.host }}')
```

3. Get the certificate of the Ingress Operator by running the following command:

```terminal
$ oc extract secret/$(oc get ingresscontroller -n openshift-ingress-operator default -o json | jq '.spec.defaultCertificate.name // "router-certs-default"' -r) -n openshift-ingress --confirm
```

4. Move the extracted certificate to the trusted CA directory of the system by running the following command:

```terminal
$ sudo mv tls.crt /etc/pki/ca-trust/source/anchors/
```

5. Enable the default certificate of the cluster to trust the route by running the following command:

```terminal
$ sudo update-ca-trust enable
```

6. Log in with podman with the default route by running the following command:

```terminal
$ sudo podman login -u kubeadmin -p $(oc whoami -t) $HOST
```


# Exposing a secure registry manually

Instead of logging in to the OpenShift image registry from within the cluster, you can gain external access to the OpenShift image registry by exposing the registry with a route. With this external access, you can log in to the registry from outside the cluster by using the route address. You can then tag and push images to an existing project by using the route host.

You can expose the route by using DefaultRoute parameter in the configs.imageregistry.operator.openshift.io resource or by using custom routes.

* The following prerequisites are automatically performed:
* Deploy the Registry Operator.
* Deploy the Ingress Operator.
* You have access to the cluster as a user with the cluster-admin role.

1. To expose the registry using DefaultRoute parameter, set DefaultRoute to True:

```terminal
$ oc patch configs.imageregistry.operator.openshift.io/cluster --patch '{"spec":{"defaultRoute":true}}' --type=merge
```

2. Log in with podman by entering the following command:

```terminal
$ HOST=$(oc get route default-route -n openshift-image-registry --template='{{ .spec.host }}')
```


```terminal
$ podman login -u kubeadmin -p $(oc whoami -t) --tls-verify=false $HOST
```

* --tls-verify=false: Set this parameter to false if the default certificate of the cluster for routes is untrusted. You can set a custom, trusted certificate as the default certificate with the Ingress Operator.
3. To expose the registry using custom routes, create a secret with your route's TLS keys. This step is optional. If you do not create a secret, the route uses the default TLS configuration from the Ingress Operator.

```terminal
$ oc create secret tls public-route-tls \
    -n openshift-image-registry \
    --cert=</path/to/tls.crt> \
    --key=</path/to/tls.key>
```

4. On the Registry Operator, enter the following command:

```terminal
$ oc edit configs.imageregistry.operator.openshift.io/cluster
```


```yaml
spec:
  routes:
    - name: public-routes
      hostname: myregistry.mycorp.organization
      secretName: public-route-tls
...
```


[NOTE]
----
Only set secretName if you are providing a custom TLS configuration for the route of the registry.
----

* Error creating TLS secret