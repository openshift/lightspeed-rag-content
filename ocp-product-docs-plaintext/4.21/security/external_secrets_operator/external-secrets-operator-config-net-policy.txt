# Configuring network policy for the operand


The External Secrets Operator for Red Hat OpenShift includes pre-defined NetworkPolicies for security, but you must configure additonal, custom policies through the ExternalSecretsConfig custom resource to set the external-secrets controller egress allow policies to communicate with external providers. These configurable policies are set via the ExternalSecretsConfig custom resource to establish the egress allow policy.

# Adding a custom network policy to allow egress to all external providers

You must configure custom policies through the ExternalSecretsConfig custom resource to allow all egress to all external providers.

* An ExternalSecretsConfig must be predefined.
* You must be able to define specific egress rules, including destination ports and protocols.

1. Edit the ExternalSecretsConfig CR by running the following command:

```terminal
$ oc edit externalsecretsconfigs.operator.openshift.io cluster
```

2. Set the policy by editing the networkPolicies section:

```yaml
apiVersion: operator.openshift.io/v1alpha1
kind: ExternalSecretsConfig
metadata:
  name: cluster
spec:
  controllerConfig:
    networkPolicies:
      - name: allow-external-secrets-egress
        componentName: CoreController
        egress: # Allow all egress traffic
```


# Adding a custom network policy to allow egress to a specific provider

You must configure custom policies through the ExternalSecretsConfig custom resource to allow all egress to a specific provider.

* An ExternalSecretsConfig must be predefined.
* You must be able to define specific egress rules, including destination ports and protocols

1. Edit the ExternalSecretsConfig CR by running the following command:

```terminal
$ oc edit externalsecretsconfigs.operator.openshift.io cluster
```

2. Set the policy by editing the networkPolicies section. The following example shows how to allow egress to Amazon Web Services (AWS) endpoints.

```yaml
apiVersion: operator.openshift.io/v1alpha1
kind: ExternalSecretsConfig
metadata:
  name: cluster
spec:
  controllerConfig:
    networkPolicies:
      - componentName: ExternalSecretsCoreController
        egress:
          # Allow egress to Kubernetes API server, AWS endpoints, and DNS
          - ports:
              - port: 443   # HTTPS (AWS Secrets Manager)
                protocol: TCP
      - name: allow-external-secrets-egress
```


where:
componentName:: Specifies the name for the core controller which is ExternalSecretsCoreController. Egress rules must specify the required ports, such as Transmission Control Protocol (TCP) port 443, for services such as the AWS Secrets Manager.

# Default ingress and egress rules

The following table summarizes the default ingress and egress rules.

