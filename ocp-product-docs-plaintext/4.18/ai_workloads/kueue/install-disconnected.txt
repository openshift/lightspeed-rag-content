# Installing Red Hat build of Kueue in a disconnected environment


Before you can install Red Hat build of Kueue on a disconnected Red Hat OpenShift Container Platform cluster, you must enable Operator Lifecycle Manager (OLM) in disconnected environments by completing the following steps:
* Disable the default remote OperatorHub sources for OLM.
* Use a workstation with full internet access to create and push local mirrors of the OperatorHub content to a mirror registry.
* Configure OLM to install and manage Operators from local sources on the mirror registry instead of the default remote sources.
After enabling OLM in a disconnected environment, you can continue to use your unrestricted workstation to keep your local OperatorHub sources updated as newer versions of Operators are released.
For full documentation on completing these steps, see the Red Hat OpenShift Container Platform documentation on Using Operator Lifecycle Manager in disconnected environments.

# Compatible environments

Before you install Red&#160;Hat build of Kueue, review this section to ensure that your cluster meets the requirements.

## Supported architectures

Red&#160;Hat build of Kueue version 1.1 and later is supported on the following architectures:

* ARM64
* 64-bit x86
* ppc64le (IBM Power(R))
* s390x (IBM Z(R))

## Supported platforms

Red&#160;Hat build of Kueue version 1.1 and later is supported on the following platforms:

* Red Hat OpenShift Container Platform
* Hosted control planes for Red Hat OpenShift Container Platform


[IMPORTANT]
----
Currently, Red Hat build of Kueue is not supported on Red Hat build of MicroShift (MicroShift).
----

# Installing the Red Hat Build of Kueue Operator

You can install the Red Hat Build of Kueue Operator on a Red Hat OpenShift Container Platform cluster by using the OperatorHub in the web console.

* You have administrator permissions on a Red Hat OpenShift Container Platform cluster.
* You have access to the Red Hat OpenShift Container Platform web console.
* You have installed and configured the cert-manager Operator for Red Hat OpenShift for your cluster.

1. In the Red Hat OpenShift Container Platform web console, click Operators -> OperatorHub.
2. Choose Red Hat Build of Kueue Operator from the list of available Operators, and click Install.

* Go to Operators -> Installed Operators and confirm that the Red Hat Build of Kueue Operator is listed with Status as Succeeded.

* Installing the cert-manager Operator for Red Hat OpenShift

# Upgrading Red Hat build of Kueue

If you have previously installed Red&#160;Hat build of Kueue, you must manually upgrade your deployment to the latest version to use the latest bug fixes and feature enhancements.

* You have installed a previous version of Red Hat build of Kueue.
* You are logged in to the Red Hat OpenShift Container Platform web console with cluster administrator permissions.

1. In the Red Hat OpenShift Container Platform web console, click Operators -> Installed Operators, then select Red Hat build of Kueue from the list.
2. From the Actions drop-down menu, select Uninstall Operator.
3. The Uninstall Operator? dialog box opens. Click Uninstall.

[IMPORTANT]
----
Selecting the Delete all operand instances for this operator checkbox before clicking Uninstall deletes all existing resources from the cluster, including:
* The Kueue CR
* Any cluster queues, local queues, or resource flavors that you have created
Leave this box unchecked when upgrading your cluster to retain your created resources.
----
4. In the Red Hat OpenShift Container Platform web console, click Operators -> OperatorHub.
5. Choose Red Hat Build of Kueue Operator from the list of available Operators, and click Install.

1. Go to Operators -> Installed Operators.
2. Confirm that the Red Hat Build of Kueue Operator is listed with Status as Succeeded.
3. Confirm that the version shown under the Operator name in the list is the latest version.

# Creating a Kueue custom resource

After you have installed the Red Hat Build of Kueue Operator, you must create a Kueue custom resource (CR) to configure your installation.

Ensure that you have completed the following prerequisites:

* The Red Hat build of Kueue Operator is installed on your cluster.
* You have cluster administrator permissions and the kueue-batch-admin-role role.
* You have access to the Red Hat OpenShift Container Platform web console.

1. In the Red Hat OpenShift Container Platform web console, click Operators -> Installed Operators.
2. In the Provided APIs table column, click Kueue. This takes you to the Kueue tab of the Operator details page.
3. Click Create Kueue. This takes you to the Create Kueue YAML view.
4. Enter the details for your Kueue CR.
Example Kueue CR

```yaml
apiVersion: kueue.openshift.io/v1
kind: Kueue
metadata:
  labels:
    app.kubernetes.io/name: kueue-operator
    app.kubernetes.io/managed-by: kustomize
  name: cluster 1
  namespace: openshift-kueue-operator
spec:
  managementState: Managed
  config:
    integrations:
      frameworks: 2
      - BatchJob
    preemption:
      preemptionPolicy: Classical 3
# ...
```

The name of the Kueue CR must be cluster.
If you want to configure Red Hat build of Kueue for use with other workload types, add those types here. For the default configuration, only the BatchJob type is recommended and supported.
Optional: If you want to configure fair sharing for Red Hat build of Kueue, set the preemptionPolicy value to FairSharing. The default setting in the Kueue CR is Classical preemption.
5. Click Create.

* After you create the Kueue CR, the web console brings you to the Operator details page, where you can see the CR in the list of Kueues.
* Optional: If you have the OpenShift CLI (`oc`) installed, you can run the following command and observe the output to confirm that your Kueue CR has been created successfully:

```terminal
$ oc get kueue
```

Example output

```terminal
NAME      	AGE
cluster   	4m
```


# Labeling namespaces to allow Red Hat build of Kueue to manage jobs

The Red&#160;Hat build of Kueue Operator uses an opt-in webhook mechanism to ensure that policies are only enforced for the jobs and namespaces that it is expected to target.

You must label the namespaces where you want Red&#160;Hat build of Kueue to manage jobs with the kueue.openshift.io/managed=true label.

* You have cluster administrator permissions.
* The Red Hat build of Kueue Operator is installed on your cluster, and you have created a Kueue custom resource (CR).
* You have installed the OpenShift CLI (`oc`).

* Add the kueue.openshift.io/managed=true label to a namespace by running the following command:

```terminal
$ oc label namespace <namespace> kueue.openshift.io/managed=true
```


When you add this label, you instruct the Red&#160;Hat build of Kueue Operator that the namespace is managed by its webhook admission controllers. As a result, any Red&#160;Hat build of Kueue resources within that namespace are properly validated and mutated.