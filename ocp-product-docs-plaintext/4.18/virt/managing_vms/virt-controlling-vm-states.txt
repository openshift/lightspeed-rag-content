# Controlling virtual machine states


You can stop, start, restart, pause, and unpause virtual machines from the web console.
You can use virtctl to manage virtual machine states and perform other actions from the CLI. For example, you can use virtctl to force stop a VM or expose a port.

# Configuring RBAC permissions for managing VM states by using the web console

To allow users to manage virtual machine (VM) states by using the Red Hat OpenShift Container Platform web console, you must create an RBAC cluster role and cluster role binding.
The cluster role uses the subresources.kubevirt.io API to define which resources can be controlled by certain users or groups.

* You have cluster administrator access to an Red Hat OpenShift Container Platform cluster where OpenShift Virtualization is installed.
* You have installed the OpenShift CLI (`oc`).

1. Create a ClusterRole object that allows the target user or group to manage VM states:

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: vm-manager-access
rules:
  - apiGroups:
      - subresources.kubevirt.io
    resources:
      - virtualmachines/start
      - virtualmachines/stop
    verbs:
      - put
# ...
```

2. Run the following command to apply the cluster role:

```terminal
$ oc apply -f <filename>.yaml
```

3. Confirm that the cluster role was created by running the following command and observing the output:

```terminal
$ oc get clusterrole <name>
```


Example output:

```terminal
NAME                AGE
vm-manager-access   15s
```

4. Inspect the details of the cluster role, and ensure the intended rules for subresources.kubevirt.io are present, specifically the virtualmachines/start and virtualmachines/stop subresources.

Run the following command and observe the output:

```terminal
$ oc describe clusterrole <name>
```


Example output:

```terminal
Name:         vm-manager-access
Labels:       <none>
Annotations:  <none>
PolicyRule:
  Resources  Non-Resource URLs  Resource Names  Verbs
  ---------  -----------------  --------------  -----
  virtualmachines/start, virtualmachines/stop with subresources.kubevirt.io group  []  []  [put]
```

5. Create a ClusterRoleBinding object to bind the cluster role you have created to the target user or group:

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: vm-manager-access-binding
subjects:
  - kind: User
    name: test-user
    apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: vm-manager-access
  apiGroup: rbac.authorization.k8s.io
```

6. Run the following command to apply the cluster role binding:

```terminal
$ oc apply -f <filename>.yaml
```

7. Confirm that the cluster role binding was created by running the following command and observing the output:

```terminal
$ oc get clusterrolebinding <name>
```


Example output:

```terminal
NAME                        AGE
vm-manager-access-binding   15s
```


1. Check if the user can start a VM by running the following command:

```terminal
$ oc auth can-i update virtualmachines/start --namespace=<namespace> --as=<user_name> --subresource=subresources.kubevirt.io
```


Example output:

```terminal
yes
```

2. Check if the user can stop a VM by running the following command:

```terminal
$ oc auth can-i update virtualmachines/stop --namespace=<namespace> --as=<user_name> --group=subresources.kubevirt.io
```


Example output:

```terminal
yes
```


# Starting a virtual machine

You can start a virtual machine from the web console.

1. Click Virtualization -> VirtualMachines from the side menu.
2. Find the row that contains the virtual machine that you want to start.
3. Navigate to the appropriate menu for your use case:
* To stay on this page, where you can perform actions on multiple virtual machines:
1. Click the Options menu . located at the far right end of the row and click Start VirtualMachine.
* To view comprehensive information about the selected virtual machine before you start it:
1. Access the VirtualMachine details page by clicking the name of the virtual machine.
2. Click Actions -> Start.


[NOTE]
----
When you start virtual machine that is provisioned from a URL source for the first time, the virtual machine has a status of Importing while OpenShift Virtualization imports the container from the URL endpoint. Depending on the size of the image, this process might take several minutes.
----

# Stopping a virtual machine

You can stop a virtual machine from the web console.

1. Click Virtualization ->  VirtualMachines from the side menu.
2. Find the row that contains the virtual machine that you want to stop.
3. Navigate to the appropriate menu for your use case:
* To stay on this page, where you can perform actions on multiple virtual machines:
1. Click the Options menu . located at the far right end of the row and click Stop VirtualMachine.
* To view comprehensive information about the selected virtual machine before you stop it:
1. Access the VirtualMachine details page by clicking the name of the virtual machine.
2. Click Actions → Stop.

# Restarting a virtual machine

You can restart a running virtual machine from the web console.


[IMPORTANT]
----
To avoid errors, do not restart a virtual machine while it has a status of Importing.
----

1. Click Virtualization -> VirtualMachines from the side menu.
2. Find the row that contains the virtual machine that you want to restart.
3. Navigate to the appropriate menu for your use case:
* To stay on this page, where you can perform actions on multiple virtual machines:
1. Click the Options menu . located at the far right end of the row and click Restart.
* To view comprehensive information about the selected virtual machine before
you restart it:
1. Access the VirtualMachine details page by clicking the name of the virtual
machine.
2. Click Actions -> Restart.

# Pausing a virtual machine

You can pause a virtual machine from the web console.

1. Click Virtualization -> VirtualMachines from the side menu.
2. Find the row that contains the virtual machine that you want to pause.
3. Navigate to the appropriate menu for your use case:
* To stay on this page, where you can perform actions on multiple virtual machines:
1. Click the Options menu . located at the far right end of the row and click Pause VirtualMachine.
* To view comprehensive information about the selected virtual machine before you pause it:
1. Access the VirtualMachine details page by clicking the name of the virtual machine.
2. Click Actions -> Pause.

# Unpausing a virtual machine

You can unpause a paused virtual machine from the web console.

* At least one of your virtual machines must have a status of Paused.

1. Click Virtualization -> VirtualMachines from the side menu.
2. Find the row that contains the virtual machine that you want to unpause.
3. Navigate to the appropriate menu for your use case:
* To stay on this page, where you can perform actions on multiple virtual machines:
1. Click the Options menu . located at the far right end of the row and click Unpause VirtualMachine.
* To view comprehensive information about the selected virtual machine before
you unpause it:
1. Access the VirtualMachine details page by clicking the name of the virtual
machine.
2. Click Actions → Unpause.

# Controlling the state of multiple virtual machines

You can start, stop, restart, pause, and unpause multiple virtual machines from the web console.

1. Navigate to Virtualization -> VirtualMachines in the web console.
2. Optional: To limit the number of displayed virtual machines, select a relevant project from the Projects list.
3. Select a checkbox next to the virtual machines you want to work with. To select all virtual machines, click the checkbox in the VirtualMachines table header.
4. Click Actions and select the intended action from the menu.